!function(t){var e,i=document.getElementById("msgPanelBody"),n=document.getElementById("inputFld"),s=document.getElementById("sendButton"),o=document.getElementById("skipButton"),l={icon:{ALERT:'<i class="fa fa-lightbulb-o"></i>',LOAD:'<i class="fa fa-circle-o-notch fa-spin"></i>'},alert:'<div class="row alert"> \t\t\t        <div class="msg alert"> \t\t\t            <p><i class="fa fa-lightbulb-o"></i> {msg}</p> \t\t\t        </div>\t\t\t    </div>',customAlert:'<div class="row alert"> \t\t\t\t\t        <div class="msg alert"> \t\t\t\t\t            <p>{ico} {msg}</p> \t\t\t\t\t        </div>\t\t\t\t\t    </div>',they:'<div class="row they">\t\t\t\t\t<div class="msg they">\t\t\t\t\t\t<p><strong>Stranger:</strong></p>\t\t\t\t\t\t<div>{msg}</div>\t\t\t\t\t</div>\t\t\t\t</div>',me:'<div class="row me">\t\t\t\t    <div class="msg me">\t\t\t\t        <p><strong>Me:</strong></p>\t\t\t\t        <div>{msg}</div>\t\t\t\t    </div>\t\t\t\t</div>'},a=16,c=13,d=10,r=116,m={flags:{holding:{shift:!1},skip:!1},render:{message:function(t,e,n){if(t&&e){t!=l.alert&&t!=l.customAlert&&(-1!=e.indexOf("\n")?e="<p>"+(e=e.split("\n")).join("</p><p>")+"</p>":(console.log("Tem \n"),e="<p>"+e+"</p>"));var s=t.replace("{msg}",e);t==l.customAlert&&n&&(s=s.replace("{ico}",n));var o=$(s);$(i).append(o)}},clear:function(){i.innerHTML=""},msg:{me:function(t){m.render.message(l.me,t)},they:function(t){m.render.message(l.they,t)},alert:function(t,e){e=null==e?l.icon.ALERT:e,m.render.message(l.customAlert,t,e)}}},scroll:{top:function(){i.scrollTop=0},bottom:function(){i.scrollTop=i.scrollHeight}},socket:{_namespace:"/chat",events:{PAIRFOUND:"pairfound",PAIRLOST:"pairlost",ALERT:"alert",SKIP:"skip"},connect:function(){console.log("Initializing socket."),e=io.connect("http://"+document.domain+":"+location.port+this._namespace),console.log("Socket up: ",e)},send:function(t){e.send(t)},receive:function(t){m.render.msg.they(t),m.scroll.bottom()},alert:function(t,e){console.log("alert: ",t),m.render.msg.alert(t)},skip:function(){console.log("Called skip.")},onPairFound:function(t){console.log("onPairFound"),m.render.clear(),m.render.msg.alert(t.msg),m.scroll.bottom(),m.input.enable()},onPairLost:function(t){console.log("pairlost"),m.render.msg.alert(t.msg),m.scroll.bottom(),m.input.disable()}},input:{disable:function(){n.disabled="disabled",$(n).addClass("disabled"),s.disabled=!0,$(s).addClass("disabled")},enable:function(){n.disabled=!1,$(n).removeClass("disabled"),s.disabled=!1,$(s).removeClass("disabled")}},onKeyUp:function(t){if(t.which==a&&(m.flags.holding.shift=!1),(t.which==c||t.which==d)&&!m.flags.holding.shift)return t.preventDefault(),void m.sendMessage()},onKeyDown:function(t){t.which==a&&(m.flags.holding.shift=!0)},sendMessage:function(){var t=n.value;n.value="",m.render.msg.me(t),m.socket.send(t),m.scroll.bottom()},skipConversation:function(){var t=$(o);t.hasClass("confirm")&&(t.removeClass("confirm"),t.addClass("skip")),m.flags.skip=!1,m.socket.skip()},sendButtonClicked:function(){m.sendMessage()},skipButtonCliked:function(){var t=$(o);t.hasClass("confirm")?(m.flags.skip=!1,m.skipConversation()):(m.flags.skip=!0,t.hasClass("skip")&&t.removeClass("skip"),t.addClass("confirm"))},initialize:function(){console.log("Initializing."),n.addEventListener("keydown",m.onKeyDown),n.addEventListener("keyup",m.onKeyUp),s.addEventListener("click",m.sendButtonClicked),o.addEventListener("click",m.skipButtonCliked),document.addEventListener("keydown",function(t){if(t.which!=r)return!0;confirm("Are you sure you want to leave? :/")||t.preventDefault()}),m.socket.connect(),e.on("message",m.socket.receive),e.on(m.socket.events.PAIRFOUND,function(t){m.socket.onPairFound(t)}),e.on(m.socket.events.PAIRLOST,function(t){m.socket.onPairLost(t)}),e.on(m.socket.events.ALERT,function(t){console.log("alert"),t.type?m.socket.alert(t.msg,t.type):m.socket.alert(t.msg),m.scroll.bottom()}),m.input.disable(),m.render.msg.alert("Connecting to someone...",l.icon.LOAD)}};m.initialize(),t.expose={Chat:m,MessageTemplate:l,sio:e}}(window);