!function(e){var t,i=document.getElementById("msgPanelBody"),s=document.getElementById("inputFld"),n=document.getElementById("sendButton"),o=document.getElementById("skipButton"),l={icon:{ALERT:'<i class="fa fa-lightbulb-o"></i>',LOAD:'<i class="fa fa-circle-o-notch fa-spin"></i>'},alert:'<div class="row alert"> \t\t\t        <div class="msg alert"> \t\t\t            <p><i class="fa fa-lightbulb-o"></i> {msg}</p> \t\t\t        </div>\t\t\t    </div>',customAlert:'<div class="row alert"> \t\t\t\t\t        <div class="msg alert"> \t\t\t\t\t            <p>{ico} {msg}</p> \t\t\t\t\t        </div>\t\t\t\t\t    </div>',they:'<div class="row they">\t\t\t\t\t<div class="msg they">\t\t\t\t\t\t<p><strong>Stranger:</strong></p>\t\t\t\t\t\t<div>{msg}</div>\t\t\t\t\t</div>\t\t\t\t</div>',me:'<div class="row me">\t\t\t\t    <div class="msg me">\t\t\t\t        <p><strong>Me:</strong></p>\t\t\t\t        <div>{msg}</div>\t\t\t\t    </div>\t\t\t\t</div>'},a=16,c=13,d=10,r={flags:{holding:{shift:!1},skip:!1,alone:!0},render:{message:function(e,t,s){if(e&&t){e!=l.alert&&e!=l.customAlert&&(-1!=t.indexOf("\n")?t="<p>"+(t=t.split("\n")).join("</p><p>")+"</p>":(console.log("Tem \n"),t="<p>"+t+"</p>"));var n=e.replace("{msg}",t);e==l.customAlert&&s&&(n=n.replace("{ico}",s));var o=$(n);$(i).append(o)}},clear:function(){i.innerHTML=""},msg:{me:function(e){r.render.message(l.me,e)},they:function(e){r.render.message(l.they,e)},alert:function(e,t){t=null==t?l.icon.ALERT:t,r.render.message(l.customAlert,e,t)}}},scroll:{top:function(){i.scrollTop=0},bottom:function(){i.scrollTop=i.scrollHeight}},socket:{_namespace:"/chat",events:{PAIRFOUND:"pairfound",PAIRLOST:"pairlost",ALERT:"alert",SKIP:"skip"},connect:function(){console.log("Initializing socket."),t=io.connect("http://"+document.domain+":"+location.port+this._namespace),console.log("Socket up: ",t)},send:function(e){t.send(e)},receive:function(e){r.render.msg.they(e),r.scroll.bottom()},alert:function(e,t){console.log("alert: ",e),r.render.msg.alert(e)},skip:function(){console.log("Called skip."),t.emit(r.socket.events.SKIP)},onPairFound:function(e){console.log("onPairFound"),r.flags.alone=!1,r.render.clear(),r.render.msg.alert(e.msg),r.scroll.bottom(),r.input.enable()},onPairLost:function(e){console.log("pairlost"),r.flags.alone=!0,r.render.msg.alert(e.msg),r.scroll.bottom(),r.input.disable()}},input:{disable:function(){s.disabled="disabled",$(s).addClass("disabled"),n.disabled=!0,$(n).addClass("disabled")},enable:function(){s.disabled=!1,$(s).removeClass("disabled"),n.disabled=!1,$(n).removeClass("disabled")},skip:{enable:function(){var e=$(o);e.hasClass("disabled")&&e.removeClass("disabled")},disable:function(){var e=$(o);e.hasClass("disabled")||e.addClass("disabled")}}},onKeyUp:function(e){if(e.which==a&&(r.flags.holding.shift=!1),(e.which==c||e.which==d)&&!r.flags.holding.shift)return e.preventDefault(),void r.sendMessage()},onKeyDown:function(e){e.which==a&&(r.flags.holding.shift=!0)},sendMessage:function(){var e=s.value;s.value="",r.render.msg.me(e),r.socket.send(e),r.scroll.bottom()},skipConversation:function(){var e=$(o);e.hasClass("confirm")&&(e.removeClass("confirm"),e.addClass("skip")),r.flags.skip=!1,r.flags.alone=!1,r.socket.skip(),r.render.clear(),r.render.msg.alert("Connecting to someone...",l.icon.LOAD),r.scroll.bottom(),r.input.disable()},sendButtonClicked:function(){r.sendMessage()},skipButtonCliked:function(){var e=$(o);r.flags.alone?r.skipConversation():e.hasClass("confirm")?(r.flags.skip=!1,r.skipConversation()):(r.flags.skip=!0,e.hasClass("skip")&&e.removeClass("skip"),e.addClass("confirm"))},initialize:function(){console.log("Initializing."),s.addEventListener("keydown",r.onKeyDown),s.addEventListener("keyup",r.onKeyUp),n.addEventListener("click",r.sendButtonClicked),o.addEventListener("click",r.skipButtonCliked),e.addEventListener("beforeunload",function(e){var t="Are you sure you want to leave? :/";return e.preventDefault(),e.returnValue=t}),r.socket.connect(),t.on("message",r.socket.receive),t.on(r.socket.events.PAIRFOUND,function(e){r.socket.onPairFound(e)}),t.on(r.socket.events.PAIRLOST,function(e){r.socket.onPairLost(e)}),t.on(r.socket.events.ALERT,function(e){console.log("alert"),e.type?r.socket.alert(e.msg,e.type):r.socket.alert(e.msg),r.scroll.bottom()}),r.input.disable(),r.render.msg.alert("Connecting to someone...",l.icon.LOAD)}};r.initialize(),e.expose={Chat:r,MessageTemplate:l,sio:t}}(window);